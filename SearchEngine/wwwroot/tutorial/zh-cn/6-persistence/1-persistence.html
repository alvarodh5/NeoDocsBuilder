<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="robots" content="index,follow">
    <meta name="author" content="neo-project">
    <meta name="application-name" content="neo.org">
    <meta name="renderer" content="ie-stand">
    <title>持久化</title>
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Neo Documentation" />
    <meta property="og:description" content="Neo Documentation" />
    <meta property="og:image" content="/img/twitter-img.jpg" />
    <meta name="twitter:title" content="Neo Documentation" />
    <meta name="twitter:description" content="Neo Documentation" />
    <meta name="twitter:image" content="/img/twitter-img.jpg" />
    <meta name="twitter:card" content="summary_large_image" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="manifest" href="/img/site.webmanifest">
    <link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <link href="https://neo-cdn.azureedge.net/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://neo-cdn.azureedge.net/lib/animate.css/animate.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/styles/default.min.css">
    <link href="/lib/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="/css/site.min.css" rel="stylesheet" />
</head>
<body data-spy="scroll" data-target="#navbar-sidenav">
    <nav class="navbar fixed-top navbar-expand-lg py-1 px-3 px-sm-4 px-md-5">
        <a class="navbar-brand" href="https://neo.org">
            <img class="logo" src="/img/logo.svg" alt="NEO Logo" />
            <img class="logo-dark" src="/img/logo-dark.svg" alt="NEO Logo" />
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/docs">Documentation</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/tutorial">Tutorial</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/faq">FAQ</a>
                </li>
                <li class="nav-item" style="margin-right: 100px">
                    <a class="nav-link" href="/articles">Articles</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-inline-block" href="javascript:" onclick="language('en-us')">EN</a>|<a class="nav-link d-inline-block" href="javascript:" onclick="language('zh-cn')">中文</a>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0 d-none">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
        </div>
    </nav>
    <div class="container-fluid" style="margin-top: 55px">
        <div class="row d-flex">
            <div class="d-none d-md-block catalog py-2 py-md-5 pl-md-3">
                
<nav class='nav nav-pills flex-column ml-3'>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>NEO 介绍</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/1-introduction/1-Introduction_to_NEO.html'>简介</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/1-introduction/2-Cryptography_Blockchain_and_Smart_Contracts.html'>密码学、区块链和智能合约</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/1-introduction/3-Fundamentals_of_NEO.html'>基础知识</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/1-introduction/resource.html'>更多资源</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>钱包</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/2-wallet/1-Introduction_to_wallets.html'>介绍</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/2-wallet/2-Key_derivation_and_address_generation_on_NEO.html'>私钥和地址生成</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/2-wallet/3-Key_encryption_and_contract_accounts.html'>私钥与合约账户</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/2-wallet/4-UTXO_and_account_models.html'>UTXO 与账户模型</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/2-wallet/resource.html'>更多资源</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>交易</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/3-transactions/1-Introduction_to_transactions.html'>介绍</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/3-transactions/2-Structure_of_NEO_transactions.html'>交易结构</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/3-transactions/3-NEO_transaction_types.html'>交易类型</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/3-transactions/4-NEO_transaction_fees.html'>交易手续费</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/3-transactions/resource.html'>更多资源</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>区块</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/4-blocks/1-Introduction_to_blocks_and_blockchain.html'>介绍</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/4-blocks/2-Structure_of_a_block.html'>区块结构</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/4-blocks/3-Block_creation_broadcasting.html'>区块创建与广播</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/4-blocks/4-Block_validation_processing.html'>区块验证</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/4-blocks/resource.html'>更多资源</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>NEO 网络</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/5-network/1-Introduction_to_the_NEO_network_protocol.html'>协议和网络</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/5-network/resource.html'>更多资源</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>持久性</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/6-persistence/1-persistence.html'>介绍</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/6-persistence/2-levelDB_data_structure.html'>LevelDB 数据结构</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>共识机制</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/7-consensus/1-Introduction_to_consensus.html'>介绍</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/7-consensus/2-Proof_of_work_and_proof_of_stake.html'>PoW 与 PoS</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/7-consensus/3-PBFT_and_DBFT.html'>pBFT 与 dBFT</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/7-consensus/4-Examples_and_consensus_scenarios_for_dBFT.html'>共识示例与场景</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/7-consensus/resource.html'>更多资源</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>智能合约</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/What_is_smart_contract.html'>介绍</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/Development_privateChain.html'>搭建私链</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/Development_set_up.html'>搭建开发环境</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/Development_compile.html'>编译、调用与部署</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/Smart_Contract_basics.html'>智能合约基础</a>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>创建 NEP-5 合约</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/What_is_nep5.html'>介绍</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/Implementation_of_NEP5.html'>实现 NEP-5</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/Give_an_ITO.html'>ITO</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/UTXO.html'>UTXO 基础</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>CGAS</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/cgas/1_what_is_cgas.html'>什么是 CGAS</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/cgas/2_global_asset_and_nep5.html'>全局资产与 NEP-5</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/cgas/3_utxo_model.html'>UTXO 模型</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/cgas/4_trigger.html'>触发器</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/cgas/5_minttokens_and_refund.html'>铸币与退款</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/cgas/6_signature_and_verification.html'>签名与验证</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/cgas/7_invocation.html'>交易调用</a>
</nav>
<a class='ml-0 my-1 nav-link' href='/tutorial/zh-cn/9-smartContract/neo_python_quickstart_cn.html'>NEO Python 快速入门</a>
</nav>
</nav>
            </div>
            <main class="p-3 p-sm-4 p-md-5">
                <a class="d-block d-md-none" href="javascript:" onclick="showCatalog()">Show / Hide Table of Contents</a>
                <h1 id='af14bcd7'><span class='with-space bd-content-title'>持久化<a class='anchorjs-link ' href='#af14bcd7' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h1>
<h2 id='dc074746'><span class='with-space bd-content-title'>序列化模型<a class='anchorjs-link ' href='#dc074746' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h2>
<p class='with-space'>NEO平台支持的原生数据类型有Integer、Decimal和String、UInt160和UInt256。该模型在持久化层和网络层中都有使用。</p>
<h3 id='dceddd53'><span class='with-space bd-content-title'>整数序列化<a class='anchorjs-link ' href='#dceddd53' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>根据存储的值，可使用可变长度的类型对整数进行编码：</p>
<figure class='with-space'><table class='table table-hover'>
<thead><tr><th>数值</th><th>长度</th><th>格式</th></tr></thead>
<tbody><tr><td>&lt; 0xfd</td><td>1</td><td>uint8</td></tr><tr><td>&lt;= 0xffff</td><td>3</td><td>0xfd + uint16</td></tr><tr><td>&lt;= 0xffffffff</td><td>5</td><td>0xfe + uint32</td></tr><tr><td>&gt; 0xffffffff</td><td>9</td><td>0xff + uint64</td></tr>
</tbody>
</table></figure>
<p class='with-space'>使用一个字节存储数值1:</p>
<p class='with-space'><img class='d-inline-block img-fluid' data-original='persistence_1_byte.png' alt='single_byte' referrerPolicy='no-referrer' /></p>
<p class='with-space'>但是数值65535需要使用3个字节进行存储:</p>
<p class='with-space'><img class='d-inline-block img-fluid' data-original='persistence_3_bytes.png' alt='three_bytes' referrerPolicy='no-referrer' /></p>
<h4 id='fdc51510'><span class='with-space bd-content-title'>整数序列化代码<a class='anchorjs-link ' href='#fdc51510' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>你可以点击 <a href='https://github.com/neo-project/neo/blob/b0793b74f25d817f826c4dca3f7f06a8b7dce88e/neo/IO/Helper.cs#L235' target='_blank'> 此处</a> 查看C#版本的整数序列化代码:</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static void WriteVarInt(this BinaryWriter writer, long value)
{
  if (value &lt; 0)
    throw new ArgumentOutOfRangeException();
  if (value &lt; 0xFD)
  {
    writer.Write((byte)value);
  }
  else if (value &lt;= 0xFFFF)
  {
    writer.Write((byte)0xFD);
    writer.Write((ushort)value);
  }
  else if (value &lt;= 0xFFFFFFFF)
  {
    writer.Write((byte)0xFE);
    writer.Write((uint)value);
  }
  else
  {
    writer.Write((byte)0xFF);
    writer.Write(value);
  }
}'>Copy</button><pre><code class='csharp' lang='csharp'>public static void WriteVarInt(this BinaryWriter writer, long value)
{
  if (value &lt; 0)
    throw new ArgumentOutOfRangeException();
  if (value &lt; 0xFD)
  {
    writer.Write((byte)value);
  }
  else if (value &lt;= 0xFFFF)
  {
    writer.Write((byte)0xFD);
    writer.Write((ushort)value);
  }
  else if (value &lt;= 0xFFFFFFFF)
  {
    writer.Write((byte)0xFE);
    writer.Write((uint)value);
  }
  else
  {
    writer.Write((byte)0xFF);
    writer.Write(value);
  }
}
</code></pre>
</figure>
<h4 id='b5219b42'><span class='with-space bd-content-title'>字节顺序<a class='anchorjs-link ' href='#b5219b42' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>除IP地址和端口号外，NEO中所有变长的整数类型都使用小端存储。</p>
<h3 id='e71864e5'><span class='with-space bd-content-title'>字符串序列化<a class='anchorjs-link ' href='#e71864e5' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>字符串使用变长的字符串变量进行编码，由一个表示字符串长度的整数以及随后紧跟的以UTF8编码的字符串构成。</p>
<figure class='with-space'><table class='table table-hover'>
<thead><tr><th>长度</th><th>字段</th><th>类型</th><th>说明</th></tr></thead>
<tbody><tr><td> <strong>？</strong> </td><td>length</td><td>integer</td><td>字符串的字节长度</td></tr><tr><td> <strong>length</strong> </td><td>string</td><td>uint8[length]</td><td>字符串本身</td></tr>
</tbody>
</table></figure>
<p class='with-space'>你可以点击 <a href='http://www.unicode.org/versions/Unicode9.0.0/ch03.pdf#page=54' target='_blank'> 此处</a> 查看关于序列化UTF-8编码的字符串的其他信息。</p>
<h4 id='de4d1fb0'><span class='with-space bd-content-title'>示例<a class='anchorjs-link ' href='#de4d1fb0' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>字符串 <code>NEO</code> 使用4个字节存储：</p>
<p class='with-space'><img class='d-inline-block img-fluid' data-original='persistence_var_string.png' alt='var_string' referrerPolicy='no-referrer' /></p>
<h4 id='a9788fab'><span class='with-space bd-content-title'>字符串序列化代码<a class='anchorjs-link ' href='#a9788fab' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>你可以点击 <a href='https://github.com/neo-project/neo/blob/b0793b74f25d817f826c4dca3f7f06a8b7dce88e/neo/IO/Helper.cs#L235' target='_blank'> 此处</a> 查看C＃版本的序列化字符串的代码：</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static void WriteVarString(this BinaryWriter writer, string value)
{
  writer.WriteVarBytes(Encoding.UTF8.GetBytes(value));
}

public static void WriteVarBytes(this BinaryWriter writer, byte[] value)
{
  writer.WriteVarInt(value.Length);
  writer.Write(value);
}'>Copy</button><pre><code class='csharp' lang='csharp'>public static void WriteVarString(this BinaryWriter writer, string value)
{
  writer.WriteVarBytes(Encoding.UTF8.GetBytes(value));
}

public static void WriteVarBytes(this BinaryWriter writer, byte[] value)
{
  writer.WriteVarInt(value.Length);
  writer.Write(value);
}
</code></pre>
</figure>
<p class='with-space'>在某些特殊场景，NEO会序列化一个固定长度的字符串。 对于这种情况，我们通过下面这种方式实现序列化：</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static void WriteFixedString(this BinaryWriter writer, string value, int length)
{
  if (value == null)
    throw new ArgumentNullException(nameof(value));
  if (value.Length &gt; length)
    throw new ArgumentException();
  byte[] bytes = Encoding.UTF8.GetBytes(value);
  if (bytes.Length &gt; length)
    throw new ArgumentException();
  writer.Write(bytes);
  if (bytes.Length &lt; length)
    writer.Write(new byte[length - bytes.Length]);
}'>Copy</button><pre><code class='csharp' lang='csharp'>public static void WriteFixedString(this BinaryWriter writer, string value, int length)
{
  if (value == null)
    throw new ArgumentNullException(nameof(value));
  if (value.Length &gt; length)
    throw new ArgumentException();
  byte[] bytes = Encoding.UTF8.GetBytes(value);
  if (bytes.Length &gt; length)
    throw new ArgumentException();
  writer.Write(bytes);
  if (bytes.Length &lt; length)
    writer.Write(new byte[length - bytes.Length]);
}
</code></pre>
</figure>
<h3 id='a4c26608'><span class='with-space bd-content-title'>UInt160 与 UInt256 序列化<a class='anchorjs-link ' href='#a4c26608' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>UInt160和UInt256都存储为固定大小的字节数组，数组长度分别是20和32字节。NEO使用RIPMED160算法计算脚本哈希，并用SHA256算法计算交易和区块的哈希值。</p>
<p class='with-space'>请注意，在NEO中，我们会使用两次哈希函数。其中第一次始终是SHA256。</p>
<p class='with-space'>UInt160最常用于计算合约的哈希值：</p>
<p class='with-space'><img class='d-inline-block img-fluid' data-original='persistence_contract.png' alt='contract' referrerPolicy='no-referrer' /></p>
<h4 id='ab78aed4'><span class='with-space bd-content-title'>合约哈希代码<a class='anchorjs-link ' href='#ab78aed4' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>使用所有者的公钥创建一个简单的合约：</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static byte[] CreateSignatureRedeemScript(ECPoint publicKey)
{
  using (ScriptBuilder sb = new ScriptBuilder())
  {
    sb.EmitPush(publicKey.EncodePoint(true));
    sb.Emit(OpCode.CHECKSIG);
    return sb.ToArray();
  }
}'>Copy</button><pre><code class='csharp' lang='csharp'>public static byte[] CreateSignatureRedeemScript(ECPoint publicKey)
{
  using (ScriptBuilder sb = new ScriptBuilder())
  {
    sb.EmitPush(publicKey.EncodePoint(true));
    sb.Emit(OpCode.CHECKSIG);
    return sb.ToArray();
  }
}
</code></pre>
</figure>
<p class='with-space'>生成的合约是一个字节数组。 使用前面说的哈希函数（RIPMED160）将该字节数组转换为脚本哈希：</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='// https://github.com/neo-project/neo/blob/41caff115c28d6c7665b2a7ac72967e7ce82e921/neo/SmartContract/Helper.cs#L82
public static UInt160 ToScriptHash(this byte[] script)
{
  return new UInt160(Crypto.Default.Hash160(script));
}

// https://github.com/neo-project/neo/blob/35ff9a68010bdddc160840f222df13c3c46290f6/neo/Cryptography/Crypto.cs#L12
public byte[] Hash160(byte[] message)
{
  return message.Sha256().RIPEMD160();
}'>Copy</button><pre><code class='csharp' lang='csharp'>// https://github.com/neo-project/neo/blob/41caff115c28d6c7665b2a7ac72967e7ce82e921/neo/SmartContract/Helper.cs#L82
public static UInt160 ToScriptHash(this byte[] script)
{
  return new UInt160(Crypto.Default.Hash160(script));
}

// https://github.com/neo-project/neo/blob/35ff9a68010bdddc160840f222df13c3c46290f6/neo/Cryptography/Crypto.cs#L12
public byte[] Hash160(byte[] message)
{
  return message.Sha256().RIPEMD160();
}
</code></pre>
</figure>
<h4 id='d8c6ff2e'><span class='with-space bd-content-title'>地址<a class='anchorjs-link ' href='#d8c6ff2e' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>UInt160用于计算合约的哈希值，该哈希值可以用于生成地址。 对合约的脚本哈希进行Base58编码，之后再附加上合约版本号作为前缀，当前为 <code>0x17</code> ，即可得出地址。</p>
<p class='with-space'><img class='d-inline-block img-fluid' data-original='persistence_address.png' alt='address' referrerPolicy='no-referrer' /></p>
<h4 id='d993f44e'><span class='with-space bd-content-title'>地址转换代码<a class='anchorjs-link ' href='#d993f44e' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>你可以点击 <a href='https://github.com/neo-project/neo/blob/a8fd76b715e675bc7982f26481ecfb9b6ea68811/neo/Wallets/Helper.cs#L16' target='_blank'> 此处</a> 查看地址转换的代码示例。 请注意，地址只是为了方便人们理解，在系统操作中始终使用的是脚本哈希。</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static string ToAddress(this UInt160 scriptHash)
{
  byte[] data = new byte[21];
  data[0] = ProtocolSettings.Default.AddressVersion;
  Buffer.BlockCopy(scriptHash.ToArray(), 0, data, 1, 20);
  return data.Base58CheckEncode();
}

public static UInt160 ToScriptHash(this string address)
{
  byte[] data = address.Base58CheckDecode();
  if (data.Length != 21)
    throw new FormatException();
  if (data[0] != ProtocolSettings.Default.AddressVersion)
    throw new FormatException();
  return new UInt160(data.Skip(1).ToArray());
}'>Copy</button><pre><code class='csharp' lang='csharp'>public static string ToAddress(this UInt160 scriptHash)
{
  byte[] data = new byte[21];
  data[0] = ProtocolSettings.Default.AddressVersion;
  Buffer.BlockCopy(scriptHash.ToArray(), 0, data, 1, 20);
  return data.Base58CheckEncode();
}

public static UInt160 ToScriptHash(this string address)
{
  byte[] data = address.Base58CheckDecode();
  if (data.Length != 21)
    throw new FormatException();
  if (data[0] != ProtocolSettings.Default.AddressVersion)
    throw new FormatException();
  return new UInt160(data.Skip(1).ToArray());
}
</code></pre>
</figure>
<h3 id='cf603a0b'><span class='with-space bd-content-title'>十进制序列化<a class='anchorjs-link ' href='#cf603a0b' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>十进制数值存储为64位长的定点数，精度为10 &lt;sup&gt; -8 &lt;/sup&gt;，取值范围为：[ -2<sup>63</sup>/ 10<sup>8</sup>，+2<sup>63</sup>/ 10<sup>8</sup>]</p>
<p class='with-space'>有关定点数的更多信息，请点击 <a href='http://www-inst.eecs.berkeley.edu/~cs61c/sp06/handout/fixedpt.html' target='_blank'> 此处</a> 查看。</p>
<h3 id='c37944a4'><span class='with-space bd-content-title'>数据结构<a class='anchorjs-link ' href='#c37944a4' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<h4 id='e726269f'><span class='with-space bd-content-title'>Arrays<a class='anchorjs-link ' href='#e726269f' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<h4 id='e5138b74'><span class='with-space bd-content-title'>Maps<a class='anchorjs-link ' href='#e5138b74' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<h4 id='fd97bbe8'><span class='with-space bd-content-title'>Structs<a class='anchorjs-link ' href='#fd97bbe8' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<h3 id='f0a5f0c9'><span class='with-space bd-content-title'>域名类序列化<a class='anchorjs-link ' href='#f0a5f0c9' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>这里使用的编码方法同样适用于网络通信模块和持久层（C＃）。 区块链由多种数据组合而成，存储在持久层中。<img class='d-inline-block img-fluid' data-original='persistence_blockchain.png' alt='blockchain' referrerPolicy='no-referrer' /></p>
<p class='with-space'>区块链中至少包含一个区块（即创世块），每个区块至少包含有一个交易（即矿工交易）。</p>
<h4 id='f1d2997e'><span class='with-space bd-content-title'>区块头<a class='anchorjs-link ' href='#f1d2997e' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>区块头包含有关该区块的所有信息，但是不包括交易。通过区块头和交易列表可以构建出一个区块，并使用默克尔根节点来对进行完整性验证。</p>
<p class='with-space'>在网络层，节点会分别对区块头和交易发起请求从而查询一个区块。</p>
<p class='with-space'><img class='d-inline-block img-fluid' data-original='persistence_header.png' alt='persistence_header' referrerPolicy='no-referrer' /></p>
<p class='with-space'>区块头的可序列化数据结构如下所示：</p>
<figure class='with-space'><table class='table table-hover'>
<thead><tr><th>长度</th><th>字段</th><th>数据类型</th><th>说明</th></tr></thead>
<tbody><tr><td>4</td><td> <strong>Version</strong> </td><td>uint32</td><td>区块的版本号，当前为0</td></tr><tr><td>32</td><td> <strong>PrevBlock</strong> </td><td>uint256</td><td>前一个区块的哈希值</td></tr><tr><td>32</td><td> <strong>MerkleRoot</strong> </td><td>uint256</td><td>交易列表的默克尔根节点哈希</td></tr><tr><td>4</td><td> <strong>Timestamp</strong> </td><td>uint32</td><td>时间戳</td></tr><tr><td>4</td><td> <strong>Height</strong> </td><td>uint32</td><td>区块高度</td></tr><tr><td>8</td><td> <strong>Nonce</strong> </td><td>uint64</td><td>随机数</td></tr><tr><td>20</td><td> <strong>NextMiner</strong> </td><td>uint160</td><td>下一轮矿工节点的合约地址</td></tr><tr><td>1</td><td> <strong>-</strong> </td><td>uint8</td><td>固定为1</td></tr><tr><td>?</td><td> <strong>Script</strong> </td><td>script</td><td>验证区块的脚本</td></tr><tr><td>uint8</td><td> <strong>-</strong> </td><td>uint8</td><td>固定为0</td></tr>
</tbody>
</table></figure>
<h4 id='b5a214f5'><span class='with-space bd-content-title'>区块<a class='anchorjs-link ' href='#b5a214f5' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>区块由一个区块头（具有多种属性）和一个交易列表组成，列表中至少包含一个交易（即矿工交易）。</p>
<p class='with-space'><img class='d-inline-block img-fluid' data-original='persistence_block.png' alt='persistence_header' referrerPolicy='no-referrer' /></p>
<p class='with-space'>区块的可序列化数据结构：</p>
<figure class='with-space'><table class='table table-hover'>
<thead><tr><th>长度</th><th>字段</th><th>数据类型</th><th>说明</th></tr></thead>
<tbody><tr><td>4</td><td> <strong>Version</strong> </td><td>uint32</td><td>区块的版本号，当前为0</td></tr><tr><td>32</td><td> <strong>PrevBlock</strong> </td><td>uint256</td><td>前一个区块的哈希值</td></tr><tr><td>32</td><td> <strong>MerkleRoot</strong> </td><td>uint256</td><td>交易列表的默克尔根节点哈希</td></tr><tr><td>4</td><td> <strong>Timestamp</strong> </td><td>uint32</td><td>时间戳</td></tr><tr><td>4</td><td> <strong>Height</strong> </td><td>uint32</td><td>区块高度</td></tr><tr><td>8</td><td> <strong>Nonce</strong> </td><td>uint64</td><td>随机数</td></tr><tr><td>20</td><td> <strong>NextMiner</strong> </td><td>uint160</td><td>下一轮矿工节点的合约地址</td></tr><tr><td>1</td><td> <strong>-</strong> </td><td>uint8</td><td>固定为1</td></tr><tr><td>？</td><td> <strong>Script</strong> </td><td>script</td><td>验证区块的脚本</td></tr><tr><td>？*？</td><td> <strong>Transactions</strong> </td><td>tx[]</td><td>交易列表</td></tr>
</tbody>
</table></figure>
<h4 id='ca429c2b'><span class='with-space bd-content-title'>(原生) 资产<a class='anchorjs-link ' href='#ca429c2b' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>原生资产表示为 <strong>RegisterTransaction</strong> 的交易哈希。资产注册后，通过发起 <strong>IssueTransaction</strong> 交易将该资产发送到某个地址。这些交易用于在 <code>创世块</code> 中产生NEO和GAS。</p>
<h4 id='d1647e3c'><span class='with-space bd-content-title'>原生资产释放代码<a class='anchorjs-link ' href='#d1647e3c' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>请点击 <a href='https://github.com/neo-project/neo/blob/41caff115c28d6c7665b2a7ac72967e7ce82e921/neo/Ledger/Blockchain.cs#L66' target='_blank'> 此处</a> 查看 <code>创世块</code> 的代码。</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static readonly Block GenesisBlock = new Block
{
    PrevHash = UInt256.Zero,
    Timestamp = (new DateTime(2016, 7, 15, 15, 8, 21, DateTimeKind.Utc)).ToTimestamp(),
    Index = 0,
    ConsensusData = 2083236893, //向比特币致敬
    NextConsensus = GetConsensusAddress(StandbyValidators),
    Witness = new Witness
    {
        InvocationScript = new byte[0],
        VerificationScript = new[] { (byte)OpCode.PUSHT }
    },
    Transactions = new Transaction[]
    {
        new MinerTransaction
        {
            Nonce = 2083236893,
            Attributes = new TransactionAttribute[0],
            Inputs = new CoinReference[0],
            Outputs = new TransactionOutput[0],
            Witnesses = new Witness[0]
        },
        GoverningToken,
        UtilityToken,
        new IssueTransaction
        {
            Attributes = new TransactionAttribute[0],
            Inputs = new CoinReference[0],
            Outputs = new[]
            {
              new TransactionOutput
              {
                    AssetId = GoverningToken.Hash,
                    Value = GoverningToken.Amount,
                    ScriptHash = Contract.CreateMultiSigRedeemScript(StandbyValidators.Length / 2 + 1, StandbyValidators).ToScriptHash()
                }
            },
            Witnesses = new[]
            {
                new Witness
                {
                    InvocationScript = new byte[0],
                    VerificationScript = new[] { (byte)OpCode.PUSHT }
                }
            }
        }
    }
};'>Copy</button><pre><code class='csharp' lang='csharp'>public static readonly Block GenesisBlock = new Block
{
    PrevHash = UInt256.Zero,
    Timestamp = (new DateTime(2016, 7, 15, 15, 8, 21, DateTimeKind.Utc)).ToTimestamp(),
    Index = 0,
    ConsensusData = 2083236893, //向比特币致敬
    NextConsensus = GetConsensusAddress(StandbyValidators),
    Witness = new Witness
    {
        InvocationScript = new byte[0],
        VerificationScript = new[] { (byte)OpCode.PUSHT }
    },
    Transactions = new Transaction[]
    {
        new MinerTransaction
        {
            Nonce = 2083236893,
            Attributes = new TransactionAttribute[0],
            Inputs = new CoinReference[0],
            Outputs = new TransactionOutput[0],
            Witnesses = new Witness[0]
        },
        GoverningToken,
        UtilityToken,
        new IssueTransaction
        {
            Attributes = new TransactionAttribute[0],
            Inputs = new CoinReference[0],
            Outputs = new[]
            {
              new TransactionOutput
              {
                    AssetId = GoverningToken.Hash,
                    Value = GoverningToken.Amount,
                    ScriptHash = Contract.CreateMultiSigRedeemScript(StandbyValidators.Length / 2 + 1, StandbyValidators).ToScriptHash()
                }
            },
            Witnesses = new[]
            {
                new Witness
                {
                    InvocationScript = new byte[0],
                    VerificationScript = new[] { (byte)OpCode.PUSHT }
                }
            }
        }
    }
};
</code></pre>
</figure>
<p class='with-space'>NEO为 <code>治理代币</code> ，注册后会被发送到 <code>验证人</code> 的多签合约地址中：</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static readonly RegisterTransaction GoverningToken = new RegisterTransaction
{
  AssetType = AssetType.GoverningToken,
  Name = &quot;[{\&quot;lang\&quot;:\&quot;zh-CN\&quot;,\&quot;name\&quot;:\&quot;小蚁股\&quot;},{\&quot;lang\&quot;:\&quot;en\&quot;,\&quot;name\&quot;:\&quot;AntShare\&quot;}]&quot;,
  Amount = Fixed8.FromDecimal(100000000),
  Precision = 0,
  Owner = ECCurve.Secp256r1.Infinity,
  Admin = (new[] { (byte)OpCode.PUSHT }).ToScriptHash(),
  Attributes = new TransactionAttribute[0],
  Inputs = new CoinReference[0],
  Outputs = new TransactionOutput[0],
  Witnesses = new Witness[0]
};'>Copy</button><pre><code class='csharp' lang='csharp'>public static readonly RegisterTransaction GoverningToken = new RegisterTransaction
{
  AssetType = AssetType.GoverningToken,
  Name = &quot;[{\&quot;lang\&quot;:\&quot;zh-CN\&quot;,\&quot;name\&quot;:\&quot;小蚁股\&quot;},{\&quot;lang\&quot;:\&quot;en\&quot;,\&quot;name\&quot;:\&quot;AntShare\&quot;}]&quot;,
  Amount = Fixed8.FromDecimal(100000000),
  Precision = 0,
  Owner = ECCurve.Secp256r1.Infinity,
  Admin = (new[] { (byte)OpCode.PUSHT }).ToScriptHash(),
  Attributes = new TransactionAttribute[0],
  Inputs = new CoinReference[0],
  Outputs = new TransactionOutput[0],
  Witnesses = new Witness[0]
};
</code></pre>
</figure>
<p class='with-space'>而GAS是 <code>功能代币</code> 。</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='public static readonly RegisterTransaction UtilityToken = new RegisterTransaction
{
  AssetType = AssetType.UtilityToken,
  Name = &quot;[{\&quot;lang\&quot;:\&quot;zh-CN\&quot;,\&quot;name\&quot;:\&quot;AntCoin \&quot;},{\&quot;lang\&quot;:\&quot;en\&quot;,\&quot;name\&quot;:\&quot;AntCoin\&quot;}]&quot;,
  Amount = Fixed8.FromDecimal(GenerationAmount.Sum(p =&gt; p) * DecrementInterval),
  Precision = 8,
  Owner = ECCurve.Secp256r1.Infinity,
  Admin = (new[] { (byte)OpCode.PUSHF }).ToScriptHash(),
  Attributes = new TransactionAttribute[0],
  Inputs = new CoinReference[0],
  Outputs = new TransactionOutput[0],
  Witnesses = new Witness[0]
};'>Copy</button><pre><code class='csharp' lang='csharp'>public static readonly RegisterTransaction UtilityToken = new RegisterTransaction
{
  AssetType = AssetType.UtilityToken,
  Name = &quot;[{\&quot;lang\&quot;:\&quot;zh-CN\&quot;,\&quot;name\&quot;:\&quot;AntCoin \&quot;},{\&quot;lang\&quot;:\&quot;en\&quot;,\&quot;name\&quot;:\&quot;AntCoin\&quot;}]&quot;,
  Amount = Fixed8.FromDecimal(GenerationAmount.Sum(p =&gt; p) * DecrementInterval),
  Precision = 8,
  Owner = ECCurve.Secp256r1.Infinity,
  Admin = (new[] { (byte)OpCode.PUSHF }).ToScriptHash(),
  Attributes = new TransactionAttribute[0],
  Inputs = new CoinReference[0],
  Outputs = new TransactionOutput[0],
  Witnesses = new Witness[0]
};
</code></pre>
</figure>
<h5 id='e949bbf4'><span class='with-space bd-content-title'>原生资产代码<a class='anchorjs-link ' href='#e949bbf4' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h5>
<p class='with-space'>原生资产可以在 <code>创世块</code> 中查看。 请注意，由于使用了 <code>Validators</code> 属性，这意味着该交易在不同的网络（主网，测试网或其他网络）中会具有不同的哈希。</p>
<h5 id='ae5cfa44'><span class='with-space bd-content-title'>弃用通知<a class='anchorjs-link ' href='#ae5cfa44' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h5>
<p class='with-space'> <strong>RegisterTransaction</strong> 和 <strong>IssueTransaction</strong> 这两种交易都已经被弃用了。 可以通过创建 <a href='https://github.com/neo-project/proposals/blob/master/nep-5.mediawiki' target='_blank'> NEP-5</a> 合约来发行自己的token。NEP-5合约通过创建 <strong>InvocationTransaction</strong> 交易来部署和运行智能合约。</p>
<h4 id='a615948c'><span class='with-space bd-content-title'>代币参考（交易输入）<a class='anchorjs-link ' href='#a615948c' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>NEO的原生资产使用了UTXO模型，这意味着要想花费代币，你需要引用给你发送代币的那个交易。该引用使用了两个属性： <code>PrevHash</code> 和 <code>PrevIndex</code> 。 <code>PrevHash</code> 表示的是交易哈希， <code>PrevIndex</code> 表示该交易在交易输出数组中所处的索引号。</p>
<p class='with-space'>在该交易中，一个代币引用（在 <code>vin</code> 数组中）会被转换为多个交易输出（ <code>vout</code> ）。 请注意，最后一个交易输出用于将零钱发送回发送方，这样他/她就可以获得另一个未花费的交易，将来可以使用。</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='{
    &quot;jsonrpc&quot;: &quot;2.0&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;result&quot;: {
        &quot;txid&quot;: &quot;0x630c74684cc6dad330397c63e8c7aa6403c043cc1f241638cff87e3b97a40716&quot;,
        &quot;size&quot;: 382,
        &quot;type&quot;: &quot;ContractTransaction&quot;,
        &quot;version&quot;: 0,
        &quot;attributes&quot;: [],
        &quot;vin&quot;: [
            {
                &quot;txid&quot;: &quot;0xd5ae4a22ffe49912a2a3dc698d39ac63a8fcf2cef63ae136850d039c312591d8&quot;,
                &quot;vout&quot;: 5
            }
        ],
        &quot;vout&quot;: [
            {
                &quot;n&quot;: 0,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;94&quot;,
                &quot;address&quot;: &quot;ATM7fayESuu1jKRWVXuNFYrq4EFfeAeSfj&quot;
            },
            {
                &quot;n&quot;: 1,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;72&quot;,
                &quot;address&quot;: &quot;AYQvsVafPPkHSTdVYYGgz1B9CPsqpM2XVk&quot;
            },
            {
                &quot;n&quot;: 2,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;45&quot;,
                &quot;address&quot;: &quot;AdPoqv3ZRAb8Bc4bUjhzHq4SBZMt6dxdfY&quot;
            },
            {
                &quot;n&quot;: 3,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;2879&quot;,
                &quot;address&quot;: &quot;Aab9jDXcs4ZRdZyJZusCExauKE5wuzzVEX&quot;
            }
        ],
        &quot;sys_fee&quot;: &quot;0&quot;,
        &quot;net_fee&quot;: &quot;0&quot;,
        &quot;scripts&quot;: [
            {
                &quot;invocation&quot;: &quot;40a623d40c74fe2d7a51a98b580c08108f1f12cc76dbaf9307320f0fd0c3d0782bf14bd32c24e8d097f8a31ab0e60bc330386f3c5d1e5f6fe25b188c8eed6d8cff&quot;,
                &quot;verification&quot;: &quot;210310c5ab33fac18c22f280c8354d872af488508de74661ec799d03c94d23515358ac&quot;
            }
        ],
        &quot;blockhash&quot;: &quot;0x5820dffbb46a86bbc7398522e157d68a2495b99b7bc5d18f4c848cde81a46c28&quot;,
        &quot;confirmations&quot;: 68436,
        &quot;blocktime&quot;: 1555106714
    }
}'>Copy</button><pre><code class='json' lang='json'>{
    &quot;jsonrpc&quot;: &quot;2.0&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;result&quot;: {
        &quot;txid&quot;: &quot;0x630c74684cc6dad330397c63e8c7aa6403c043cc1f241638cff87e3b97a40716&quot;,
        &quot;size&quot;: 382,
        &quot;type&quot;: &quot;ContractTransaction&quot;,
        &quot;version&quot;: 0,
        &quot;attributes&quot;: [],
        &quot;vin&quot;: [
            {
                &quot;txid&quot;: &quot;0xd5ae4a22ffe49912a2a3dc698d39ac63a8fcf2cef63ae136850d039c312591d8&quot;,
                &quot;vout&quot;: 5
            }
        ],
        &quot;vout&quot;: [
            {
                &quot;n&quot;: 0,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;94&quot;,
                &quot;address&quot;: &quot;ATM7fayESuu1jKRWVXuNFYrq4EFfeAeSfj&quot;
            },
            {
                &quot;n&quot;: 1,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;72&quot;,
                &quot;address&quot;: &quot;AYQvsVafPPkHSTdVYYGgz1B9CPsqpM2XVk&quot;
            },
            {
                &quot;n&quot;: 2,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;45&quot;,
                &quot;address&quot;: &quot;AdPoqv3ZRAb8Bc4bUjhzHq4SBZMt6dxdfY&quot;
            },
            {
                &quot;n&quot;: 3,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;2879&quot;,
                &quot;address&quot;: &quot;Aab9jDXcs4ZRdZyJZusCExauKE5wuzzVEX&quot;
            }
        ],
        &quot;sys_fee&quot;: &quot;0&quot;,
        &quot;net_fee&quot;: &quot;0&quot;,
        &quot;scripts&quot;: [
            {
                &quot;invocation&quot;: &quot;40a623d40c74fe2d7a51a98b580c08108f1f12cc76dbaf9307320f0fd0c3d0782bf14bd32c24e8d097f8a31ab0e60bc330386f3c5d1e5f6fe25b188c8eed6d8cff&quot;,
                &quot;verification&quot;: &quot;210310c5ab33fac18c22f280c8354d872af488508de74661ec799d03c94d23515358ac&quot;
            }
        ],
        &quot;blockhash&quot;: &quot;0x5820dffbb46a86bbc7398522e157d68a2495b99b7bc5d18f4c848cde81a46c28&quot;,
        &quot;confirmations&quot;: 68436,
        &quot;blocktime&quot;: 1555106714
    }
}
</code></pre>
</figure>
<p class='with-space'>现在根据交易哈希和索引，就可以在另一个交易中引用到交易输出中索引为1的交易。 在本示例中，前一个交易的哈希是 <code>0x630c74684cc6dad330397c63e8c7aa6403c043cc1f241638cff87e3b97a40716</code> ，索引是 <code>1</code> 。</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='{
    &quot;jsonrpc&quot;: &quot;2.0&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;result&quot;: {
        &quot;txid&quot;: &quot;0xd59ab9e40e3dc5302fb6ca464823f3569eceace69f3a30a41d1ef1e86225e467&quot;,
        &quot;size&quot;: 245,
        &quot;type&quot;: &quot;ContractTransaction&quot;,
        &quot;version&quot;: 0,
        &quot;attributes&quot;: [
            {
                &quot;usage&quot;: &quot;Remark&quot;,
                &quot;data&quot;: &quot;4f335853454e44&quot;
            }
        ],
        &quot;vin&quot;: [
            {
                &quot;txid&quot;: &quot;0x630c74684cc6dad330397c63e8c7aa6403c043cc1f241638cff87e3b97a40716&quot;,
                &quot;vout&quot;: 1
            },
            {
                &quot;txid&quot;: &quot;0xd5ae4a22ffe49912a2a3dc698d39ac63a8fcf2cef63ae136850d039c312591d8&quot;,
                &quot;vout&quot;: 3
            }
        ],
        &quot;vout&quot;: [
            {
                &quot;n&quot;: 0,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;180&quot;,
                &quot;address&quot;: &quot;Ab4U1pBCQCDSKWq4nHvUtXdbQPB6DsDj8S&quot;
            }
        ],
        &quot;sys_fee&quot;: &quot;0&quot;,
        &quot;net_fee&quot;: &quot;0&quot;,
        &quot;scripts&quot;: [
            {
                &quot;invocation&quot;: &quot;40fafd537ad4a8aabf3645d8f546b9f7207facbd4cb6647d2d8bb2c9eb400269ddd97c37c511fb72c4d3e3d0a01ee979eab8da87fa7e45c912adb801e006c08e30&quot;,
                &quot;verification&quot;: &quot;2102bed127ae7e97f4954280b96359a17f1672e79a2ff2084c2750c34681b7ae0dc2ac&quot;
            }
        ],
        &quot;blockhash&quot;: &quot;0xbc9626bcdfa31c6efdf19e6de2b52a8a9b86d0cf660c4e83c4b09c3e382231f9&quot;,
        &quot;confirmations&quot;: 59884,
        &quot;blocktime&quot;: 1555278520
    }
}'>Copy</button><pre><code class='json' lang='json'>{
    &quot;jsonrpc&quot;: &quot;2.0&quot;,
    &quot;id&quot;: &quot;1&quot;,
    &quot;result&quot;: {
        &quot;txid&quot;: &quot;0xd59ab9e40e3dc5302fb6ca464823f3569eceace69f3a30a41d1ef1e86225e467&quot;,
        &quot;size&quot;: 245,
        &quot;type&quot;: &quot;ContractTransaction&quot;,
        &quot;version&quot;: 0,
        &quot;attributes&quot;: [
            {
                &quot;usage&quot;: &quot;Remark&quot;,
                &quot;data&quot;: &quot;4f335853454e44&quot;
            }
        ],
        &quot;vin&quot;: [
            {
                &quot;txid&quot;: &quot;0x630c74684cc6dad330397c63e8c7aa6403c043cc1f241638cff87e3b97a40716&quot;,
                &quot;vout&quot;: 1
            },
            {
                &quot;txid&quot;: &quot;0xd5ae4a22ffe49912a2a3dc698d39ac63a8fcf2cef63ae136850d039c312591d8&quot;,
                &quot;vout&quot;: 3
            }
        ],
        &quot;vout&quot;: [
            {
                &quot;n&quot;: 0,
                &quot;asset&quot;: &quot;0xc56f33fc6ecfcd0c225c4ab356fee59390af8560be0e930faebe74a6daff7c9b&quot;,
                &quot;value&quot;: &quot;180&quot;,
                &quot;address&quot;: &quot;Ab4U1pBCQCDSKWq4nHvUtXdbQPB6DsDj8S&quot;
            }
        ],
        &quot;sys_fee&quot;: &quot;0&quot;,
        &quot;net_fee&quot;: &quot;0&quot;,
        &quot;scripts&quot;: [
            {
                &quot;invocation&quot;: &quot;40fafd537ad4a8aabf3645d8f546b9f7207facbd4cb6647d2d8bb2c9eb400269ddd97c37c511fb72c4d3e3d0a01ee979eab8da87fa7e45c912adb801e006c08e30&quot;,
                &quot;verification&quot;: &quot;2102bed127ae7e97f4954280b96359a17f1672e79a2ff2084c2750c34681b7ae0dc2ac&quot;
            }
        ],
        &quot;blockhash&quot;: &quot;0xbc9626bcdfa31c6efdf19e6de2b52a8a9b86d0cf660c4e83c4b09c3e382231f9&quot;,
        &quot;confirmations&quot;: 59884,
        &quot;blocktime&quot;: 1555278520
    }
}
</code></pre>
</figure>
<p class='with-space'>代币只能通过被引用的方式来花费。 构建索引是钱包提供的服务之一。 当向钱包添加账户时，钱包会搜索所有区块以便找到属于该地址的交易。 通过这种方式，当用户需要发送资金时，就可以找到这些未花费代币的引用并使用它们来构建交易。 在轻钱包中，由于不会存储区块链数据，我们使用 <a href='neoscan.io'> neoscan.io</a> 等外部服务来获取用户账户的余额（未花费的代币引用）。</p>
<p class='with-space'>常规节点不会提供构建索引服务，但是，目前正在构建的一个插件，可以用于向C#节点添加索引功能。</p>
<h4 id='eb73edb4'><span class='with-space bd-content-title'>交易属性<a class='anchorjs-link ' href='#eb73edb4' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>交易可能具有特殊属性，这取决于它们所属的类型。 交易属性的序列化在 <code>Version</code> 字段之后。</p>
<h5 id='d6a0c6da'><span class='with-space bd-content-title'>矿工交易的属性<a class='anchorjs-link ' href='#d6a0c6da' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h5>
<p class='with-space'> <code>MinerTransaction</code> 有一个名为 <code>nonce</code> 的属性，用于避免哈希冲突。</p>
<p class='with-space'>矿工交易中的特殊属性：</p>
<figure class='with-space'><table class='table table-hover'>
<thead><tr><th>长度</th><th>字段</th><th>数据类型</th><th>描述</th></tr></thead>
<tbody><tr><td>4</td><td> <strong>Nonce</strong> </td><td>uint32</td><td>随机数</td></tr>
</tbody>
</table></figure>
<h4 id='cfd266e3'><span class='with-space bd-content-title'>见证人<a class='anchorjs-link ' href='#cfd266e3' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<h4 id='fffeaefd'><span class='with-space bd-content-title'>合约<a class='anchorjs-link ' href='#fffeaefd' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<h4 id='e862a468'><span class='with-space bd-content-title'>交易<a class='anchorjs-link ' href='#e862a468' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h4>
<p class='with-space'>交易用于作为账本的输入。 可以用于提取GAS，转账原生资产以及其他一些对区块链的操作。交易的序列化取决于要在账本中注册的交易类型。</p>
<figure class='with-space'><table class='table table-hover'>
<thead><tr><th>长度</th><th>字段</th><th>数据类型</th><th>说明</th></tr></thead>
<tbody><tr><td>1</td><td> <strong>Type</strong> </td><td>uint8</td><td>合约类型</td></tr><tr><td>1</td><td> <strong>Version</strong> </td><td>uint8</td><td>交易版本号，当前为0</td></tr><tr><td>?</td><td> <strong>-</strong> </td><td>-</td><td>指定交易类型的数据</td></tr><tr><td>?*?</td><td> <strong>Attributes</strong> </td><td>tx_attr[]</td><td>交易具有的其他属性</td></tr><tr><td>34*？</td><td> <strong>Inputs</strong> </td><td>tx_in[]</td><td>输入</td></tr><tr><td>60*？</td><td> <strong>Outputs</strong> </td><td>tx_out[]</td><td>输出</td></tr><tr><td>？*？</td><td> <strong>Scripts</strong> </td><td>script[]</td><td>用于验证交易的脚本列表</td></tr>
</tbody>
</table></figure>
<h5 id='c076b41f'><span class='with-space bd-content-title'>合约交易<a class='anchorjs-link ' href='#c076b41f' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h5>
<p class='with-space'>合约交易的类型为 <code>0x80</code> 。 使用的验证脚本通常是一个64字节长的签名。</p>
<h5 id='ec555107'><span class='with-space bd-content-title'>InvocationTransaction<a class='anchorjs-link ' href='#ec555107' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h5>
<p class='with-space'>测试调用</p>
<p class='with-space'>附加系统费</p>
<p class='with-space'>附加网络费</p>
<h2 id='b892d84a'><span class='with-space bd-content-title'>阅读下节<a class='anchorjs-link ' href='#b892d84a' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h2>
<p class='with-space'> <a href='2-levelDB_data_structure.html'> LevelDB 区块链数据结构</a> </p>
            </main>
            <div class="d-none d-lg-block side-nav py-2 py-md-5">
                <a href="https://github.com/neo-project/docs/blob/master/tutorial/zh-cn/6-persistence\1-persistence.md" class="contribution-link d-block">Improve this Doc</a>
                <div class="side-nav-text">In this article</div>
                <div id="navbar-sidenav">
                    <nav class='nav nav-pills flex-column'>
<a class='ml--2 d-none my-1 nav-link' href='#af14bcd7'>持久化</a>
<nav class='nav nav-pills flex-column'>
<a class='ml-0 my-1 nav-link' href='#dc074746'>序列化模型</a>
<nav class='nav nav-pills flex-column'>
<a class='ml-2 my-1 nav-link' href='#dceddd53'>整数序列化</a>
<a class='ml-2 my-1 nav-link' href='#e71864e5'>字符串序列化</a>
<a class='ml-2 my-1 nav-link' href='#a4c26608'>UInt160 与 UInt256 序列化</a>
<a class='ml-2 my-1 nav-link' href='#cf603a0b'>十进制序列化</a>
<a class='ml-2 my-1 nav-link' href='#c37944a4'>数据结构</a>
<a class='ml-2 my-1 nav-link' href='#f0a5f0c9'>域名类序列化</a>
</nav>
<a class='ml-0 my-1 nav-link' href='#b892d84a'>阅读下节</a>
</nav>
</nav>
                </div>
            </div>
        </div>
    </div>
    <div class="lightbulb" title="Turn On/Off" onclick="turnOff()">
        <i class="far fa-lightbulb"></i>
    </div>
    <footer>
        <div class="d-flex justify-content-between py-1 px-3 px-sm-4 px-md-5">
            <ul class="d-none d-md-block">
                <li><a href="https://github.com/neo-project/docs" title="GitHub" target="_blank">GitHub</a></li>
                <li><a href="https://github.com/neo-project/docs/issues" title="Issue" target="_blank">Issue</a></li>
                <li><a href="https://discord.io/neo" title="Discord" target="_blank">Discord</a></li>
            </ul>
            <p>Build by <a href="https://github.com/chenzhitong/NeoDocsBuilder" title="NeoDocsBuilder" target="_blank">NeoDocsBuilder</a></p>
            <p>Licensed under <a href="https://github.com/neo-project/docs/blob/master/LICENSE" title="CC-BY-4.0" target="_blank">CC-BY-4.0</a> license. </p>
        </div>
    </footer>
    <script src="https://neo-cdn.azureedge.net/lib/jquery/jquery.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/lib/popper.js/popper.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/js/jquery.lazyload.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/js/text-autospace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130525731-2"></script>
    <script src="/js/site.min.js"></script>
    <script>
        //适用于FAQ的根据标题展开收缩
        if (false) {
            $("h2").click(function (e) {
                $(".div-collapse").not($(e.target).parents("h2").next()).hide("fast");
                $(e.target).parents("h2").next().toggle("fast");
            });
        }
    </script>
</body>
</html>

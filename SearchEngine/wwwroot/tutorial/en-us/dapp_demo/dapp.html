<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="robots" content="index,follow">
    <meta name="author" content="neo-project">
    <meta name="application-name" content="neo.org">
    <meta name="renderer" content="ie-stand">
    <title>Smart contract</title>
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Neo Documentation" />
    <meta property="og:description" content="Neo Documentation" />
    <meta property="og:image" content="/img/twitter-img.jpg" />
    <meta name="twitter:title" content="Neo Documentation" />
    <meta name="twitter:description" content="Neo Documentation" />
    <meta name="twitter:image" content="/img/twitter-img.jpg" />
    <meta name="twitter:card" content="summary_large_image" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="manifest" href="/img/site.webmanifest">
    <link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <link href="https://neo-cdn.azureedge.net/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://neo-cdn.azureedge.net/lib/animate.css/animate.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/styles/default.min.css">
    <link href="/lib/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="/css/site.min.css" rel="stylesheet" />
</head>
<body data-spy="scroll" data-target="#navbar-sidenav">
    <nav class="navbar fixed-top navbar-expand-lg py-1 px-3 px-sm-4 px-md-5">
        <a class="navbar-brand" href="https://neo.org">
            <img class="logo" src="/img/logo.svg" alt="NEO Logo" />
            <img class="logo-dark" src="/img/logo-dark.svg" alt="NEO Logo" />
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/docs">Documentation</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/tutorial">Tutorial</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/faq">FAQ</a>
                </li>
                <li class="nav-item" style="margin-right: 100px">
                    <a class="nav-link" href="/articles">Articles</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-inline-block" href="javascript:" onclick="language('en-us')">EN</a>|<a class="nav-link d-inline-block" href="javascript:" onclick="language('zh-cn')">中文</a>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0 d-none">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
        </div>
    </nav>
    <div class="container-fluid" style="margin-top: 55px">
        <div class="row d-flex">
            <div class="d-none d-md-block catalog py-2 py-md-5 pl-md-3">
                
<nav class='nav nav-pills flex-column ml-3'>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Introduction to NEO</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/1-introduction/1-Introduction_to_NEO.html'>Introduction</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/1-introduction/2-Cryptography_Blockchain_and_Smart_Contracts.html'>Cryptography, Blockchain, and Smart Contracts</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/1-introduction/3-Fundamentals_of_NEO.html'>NEO Fundamentals</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/1-introduction/resource.html'>Additional Resources</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Wallet</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/2-wallet/1-Introduction_to_wallets.html'>Introduction</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/2-wallet/2-Key_derivation_and_address_generation_on_NEO.html'>Keys and Addresses</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/2-wallet/3-Key_encryption_and_contract_accounts.html'>Private key encryption and Wallet files</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/2-wallet/4-UTXO_and_account_models.html'>The UTXO and Account models</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/2-wallet/resource.html'>Additional Resources</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Transactions</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/3-transactions/1-Introduction_to_transactions.html'>Introduction</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/3-transactions/2-Structure_of_NEO_transactions.html'>Structure of NEO transactions</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/3-transactions/3-NEO_transaction_types.html'>NEO transaction types</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/3-transactions/4-NEO_transaction_fees.html'>Transaction fees</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/3-transactions/resource.html'>Additional Resources</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Blocks</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/4-blocks/1-Introduction_to_blocks_and_blockchain.html'>Introduction</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/4-blocks/2-Structure_of_a_block.html'>Structure of a Block</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/4-blocks/3-Block_creation_broadcasting.html'>Block Creation and Broadcasting</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/4-blocks/4-Block_validation_processing.html'>Block Validation and Processing</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/4-blocks/resource.html'>Additional Resources</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Network</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/5-network/1-Introduction_to_the_NEO_network_protocol.html'>NEO Network and Protocol</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/5-network/resource.html'>Additional Resources</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Persistence</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/6-persistence/1-persistence.html'>Introduction</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/6-persistence/2-levelDB_data_structure.html'>Developing a NEO Ping using Golang</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Consensus</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/7-consensus/1-Introduction_to_consensus.html'>Introduction</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/7-consensus/2-Proof_of_work_and_proof_of_stake.html'>PoW and PoS</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/7-consensus/3-PBFT_and_DBFT.html'>pBFT and dBFT</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/7-consensus/4-Examples_and_consensus_scenarios_for_dBFT.html'>dBFT Consensus Examples and Scenarios</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/7-consensus/resource.html'>Additional Resources</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Smart Contract</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/What_is_smart_contract.html'>Introduction</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/Development_privateChain.html'>Setting up a Private Chain</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/Development_set_up.html'>Setting up Development Enviroment</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/Development_compile.html'>Contract Invoking and Deployment</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/Smart_Contract_basics.html'>Smart Contract Basics</a>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Make your NEP-5 Token</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/What_is_nep5.html'>Introduction to NEP-5</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/Implementation_of_NEP5.html'>Implementation of NEP-5</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/Give_an_ITO.html'>ITO(Initial Token Offering)</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/UTXO.html'>UTXO basics</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>CGAS</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/cgas/1_what_is_cgas.html'>What is CGAS</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/cgas/2_global_asset_and_nep5.html'>Global asset and NEP-5</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/cgas/3_utxo_model.html'>UTXO model</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/cgas/4_trigger.html'>Trigger</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/cgas/5_minttokens_and_refund.html'>Mint and Refund</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/cgas/6_signature_and_verification.html'>Signature and Verification</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/cgas/7_invocation.html'>Transaction Invocation</a>
</nav>
<span class='ml-0 my-1 nav-link'><i class='fas fa-caret-right'></i>Write NEO smart contract with Python</span>
<nav class='nav nav-pills flex-column ml-3'>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/neopython/part1_setup.html'>Installing and Setting up the Environment</a>
<a class='ml-0 my-1 nav-link' href='/tutorial/en-us/9-smartContract/neopython/part2_neopy.html'>Wallet Operations and Smart Contracts</a>
</nav>
</nav>
</nav>
            </div>
            <main class="p-3 p-sm-4 p-md-5">
                <a class="d-block d-md-none" href="javascript:" onclick="showCatalog()">Show / Hide Table of Contents</a>
                <p class='with-space'>serialisation# Building a Dapp based on NEO</p>
<p class='with-space'><div align="center">
<img src="dapp.png" alt="NEO-Tutorial" height="500"> <p>Dapp Demo : NEO house</p> </div></p>
<p class='with-space'>In this tutorial we are going to build your first Dapp on the NEO, which is an online NEO game shop. This tutorial is for general developers who has basic knowledge of web development and understanding the usage of javascript. And before this tutorial, it is better to learn the <a href='https://github.com/neo-ngd/NEO-Tutorial/blob/master/9-smartContract/Smart_Contract_basics.md' target='_blank'> NEO smart contract development</a> first.</p>
<h2 id='fe5baa33'><span class='with-space bd-content-title'>Smart contract<a class='anchorjs-link ' href='#fe5baa33' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h2>
<p class='with-space'>The main purpose of this demo is to writing the smart contract and using the javascript to handle the front-end logic for its usage.</p>
<p class='with-space'>First of all, we need to write the smart contract part. The general idea of this NEO game shop is each item in the shop has an ID, and the shop offer a kind of coupon which we can exchange from the store and then buy these items. Therefore, we can use the most part of <a href='https://neo-ngd.github.io/NEO-Tutorial/en/9-smartContract/Give_an_ITO.html#give-an-ito-initial-token-offering' target='_blank'> ITO</a> contract, to let players exchange the coupon within the store, and then use the coupon to buy the Item.</p>
<h3 id='c6db5055'><span class='with-space bd-content-title'>Constant properties<a class='anchorjs-link ' href='#c6db5055' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>First of all, here are some constant property for this smart contract. Here we first define a <code>NEP-5</code> similar asset<em>NEO GAME DIAMOND</em>, which is used to buy items in the shop. The Neo game diamond has such a list of properties:</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='private const ulong factor = 100000000; //decided by Decimals()
private const ulong initValue = 100000000 * factor;

......

[DisplayName(&quot;name&quot;)]
public static string Name() =&gt; &quot;NEO GAME DIAMOND&quot;; //name of the token

[DisplayName(&quot;symbol&quot;)]
public static string Symbol() =&gt; &quot;NGD&quot;; //symbol of the token

......


[DisplayName(&quot;totalSupply&quot;)]
public static BigInteger TotalSupply()
{
    StorageMap contract = Storage.CurrentContext.CreateMap(nameof(contract));
    return contract.Get(&quot;totalSupply&quot;).AsBigInteger();
}'>Copy</button><pre><code class='csharp' lang='csharp'>private const ulong factor = 100000000; //decided by Decimals()
private const ulong initValue = 100000000 * factor;

......

[DisplayName(&quot;name&quot;)]
public static string Name() =&gt; &quot;NEO GAME DIAMOND&quot;; //name of the token

[DisplayName(&quot;symbol&quot;)]
public static string Symbol() =&gt; &quot;NGD&quot;; //symbol of the token

......


[DisplayName(&quot;totalSupply&quot;)]
public static BigInteger TotalSupply()
{
    StorageMap contract = Storage.CurrentContext.CreateMap(nameof(contract));
    return contract.Get(&quot;totalSupply&quot;).AsBigInteger();
}
</code></pre>
</figure>
<h3 id='b312cab3'><span class='with-space bd-content-title'>exchange_token(Mint Token)<a class='anchorjs-link ' href='#b312cab3' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>This is similar function as mint token in the <a href='https://neo-ngd.github.io/NEO-Tutorial/en/9-smartContract/Give_an_ITO.html#give-an-ito-initial-token-offering' target='_blank'> ITO</a> . What end user can do is to send <code>NEO</code> to the smart contract and take NEP-5 to his balance.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='[DisplayName(&quot;exchange_token&quot;)]
public static object exchange_token()
{
    Transaction tx = (Transaction)ExecutionEngine.ScriptContainer;
    TransactionOutput reference = tx.GetReferences()[0];
    if (reference.AssetId.AsBigInteger() != AssetId.AsBigInteger()) return false;

    byte[] sender = reference.ScriptHash;
    byte[] receiver = ExecutionEngine.ExecutingScriptHash;
    ulong value = 0;
    TransactionOutput[] outputs = tx.GetOutputs();

    // get the total amount of Neo
    foreach (TransactionOutput output in outputs)
    {
        if (output.ScriptHash == receiver)
        {
            value += (ulong)output.Value;
        }
    }

    ulong exchanged_amount = value * 10;
    StorageMap asset = Storage.CurrentContext.CreateMap(nameof(asset));
    BigInteger balance = asset.Get(sender).AsBigInteger();
    asset.Put(Owner, balance + exchanged_amount);
    return true;
}'>Copy</button><pre><code class='csharp' lang='csharp'>[DisplayName(&quot;exchange_token&quot;)]
public static object exchange_token()
{
    Transaction tx = (Transaction)ExecutionEngine.ScriptContainer;
    TransactionOutput reference = tx.GetReferences()[0];
    if (reference.AssetId.AsBigInteger() != AssetId.AsBigInteger()) return false;

    byte[] sender = reference.ScriptHash;
    byte[] receiver = ExecutionEngine.ExecutingScriptHash;
    ulong value = 0;
    TransactionOutput[] outputs = tx.GetOutputs();

    // get the total amount of Neo
    foreach (TransactionOutput output in outputs)
    {
        if (output.ScriptHash == receiver)
        {
            value += (ulong)output.Value;
        }
    }

    ulong exchanged_amount = value * 10;
    StorageMap asset = Storage.CurrentContext.CreateMap(nameof(asset));
    BigInteger balance = asset.Get(sender).AsBigInteger();
    asset.Put(Owner, balance + exchanged_amount);
    return true;
}
</code></pre>
</figure>
<p class='with-space'>The code above is the whole exchange_token function. First of all, it has to extract the transaction of current smart contract invocation and get the UTXO that points to this smart contract, and check if it is sending NEO.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='Transaction tx = (Transaction)ExecutionEngine.ScriptContainer;
TransactionOutput reference = tx.GetReferences()[0];
if (reference.AssetId.AsBigInteger() != AssetId.AsBigInteger()) return false;'>Copy</button><pre><code class='csharp' lang='csharp'>Transaction tx = (Transaction)ExecutionEngine.ScriptContainer;
TransactionOutput reference = tx.GetReferences()[0];
if (reference.AssetId.AsBigInteger() != AssetId.AsBigInteger()) return false;
</code></pre>
</figure>
<p class='with-space'>Next step is to calculate how much <code>NEO</code> the user wants to exchange the NEP5 token. To get it, just get all the output and to check if the outputs script is the smart contract address. For more detail about transaction, inputs and outputs, see this <a href='https://github.com/neo-ngd/NEO-Tutorial/blob/master/en/9-smartContract/UTXO.md' target='_blank'> UTXO</a> .</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='// get the total amount of Neo
foreach (TransactionOutput output in outputs)
{
    if (output.ScriptHash == receiver)
    {
        value += (ulong)output.Value;
    }
}'>Copy</button><pre><code class='csharp' lang='csharp'>// get the total amount of Neo
foreach (TransactionOutput output in outputs)
{
    if (output.ScriptHash == receiver)
    {
        value += (ulong)output.Value;
    }
}
</code></pre>
</figure>
<p class='with-space'>Finally, we know the amount of NEO and then change the NEP-5 asset balance of the sender.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='ulong exchanged_amount = value * 10;
StorageMap asset = Storage.CurrentContext.CreateMap(nameof(asset));
BigInteger balance = asset.Get(sender).AsBigInteger();
asset.Put(Owner, balance + exchanged_amount);'>Copy</button><pre><code class='csharp' lang='csharp'>ulong exchanged_amount = value * 10;
StorageMap asset = Storage.CurrentContext.CreateMap(nameof(asset));
BigInteger balance = asset.Get(sender).AsBigInteger();
asset.Put(Owner, balance + exchanged_amount);
</code></pre>
</figure>
<h3 id='c9d4a3e7'><span class='with-space bd-content-title'>Buy Items<a class='anchorjs-link ' href='#c9d4a3e7' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>To buy items from the store, first thing is to decrease the number of Diamond from user. This is exactly same as invoke transfer function in the normal NEP-5 Token.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='StorageMap asset = Storage.CurrentContext.CreateMap(nameof(asset));
var fromAmount = asset.Get(from).AsBigInteger();
if (fromAmount &lt; amount)
    return false;
//Reduce payer balances
if (fromAmount == amount)
    asset.Delete(from);
else
    asset.Put(from, fromAmount - amount);
//Increase the payee balance
var toAmount = asset.Get(Owner).AsBigInteger();
asset.Put(Owner, toAmount + amount);'>Copy</button><pre><code class='csharp' lang='csharp'>StorageMap asset = Storage.CurrentContext.CreateMap(nameof(asset));
var fromAmount = asset.Get(from).AsBigInteger();
if (fromAmount &lt; amount)
    return false;
//Reduce payer balances
if (fromAmount == amount)
    asset.Delete(from);
else
    asset.Put(from, fromAmount - amount);
//Increase the payee balance
var toAmount = asset.Get(Owner).AsBigInteger();
asset.Put(Owner, toAmount + amount);
</code></pre>
</figure>
<p class='with-space'>Now, after taking the Diamond, the item should be stored for user. In this Demo, each Item is just a random string as a Id and stored in the storage under each user account. In real life case, it can use Non-fungible token instead. In addition, here we just store the string Id in storage using <code>neo</code> word as a splitter and concat items in to one long string. Then in the front end, we can use javascript to slice it. However, this is just for demo purpose and in production. This should be replaced by using deserialisation and serialisation.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='StorageMap item = Storage.CurrentContext.CreateMap(nameof(item));
byte[] my_item = item.Get(from);
if (my_item.Length == 0)
{
    item.Put(from, to);
}
else
{
    item.Put(from, my_item.Concat(slider).Concat(to));

}'>Copy</button><pre><code class='csharp' lang='csharp'>StorageMap item = Storage.CurrentContext.CreateMap(nameof(item));
byte[] my_item = item.Get(from);
if (my_item.Length == 0)
{
    item.Put(from, to);
}
else
{
    item.Put(from, my_item.Concat(slider).Concat(to));

}
</code></pre>
</figure>
<h3 id='b8a6cdcc'><span class='with-space bd-content-title'>Check Items<a class='anchorjs-link ' href='#b8a6cdcc' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>To check the items, it is just read from the storage.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='StorageMap item = Storage.CurrentContext.CreateMap(nameof(item));
String my_item= item.Get(from).AsString();
return my_item;'>Copy</button><pre><code class='csharp' lang='csharp'>StorageMap item = Storage.CurrentContext.CreateMap(nameof(item));
String my_item= item.Get(from).AsString();
return my_item;
</code></pre>
</figure>
<p class='with-space'>Now we finish the smart contract part. Let us move to the front-end side.</p>
<h2 id='bf4394e8'><span class='with-space bd-content-title'>Front end<a class='anchorjs-link ' href='#bf4394e8' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h2>
<h3 id='cb862f97'><span class='with-space bd-content-title'>Usage of neon-js<a class='anchorjs-link ' href='#cb862f97' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>The <a href='https://cityofzion.io/neon-js/' target='_blank'> neon-js</a> JS SDK for NEO BlockChain. It make developer easy to call RPC methods of NEO and also provide some encapsulated function to call smart contract and sending assets. It includes the wallet functions and transaction functions.</p>
<p class='with-space'>To use neon-js in the browser, the simplest way is to include the source file in the html</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='&lt;script src=&quot;https://unpkg.com/@cityofzion/neon-js&quot;&gt;&lt;/script&gt;'>Copy</button><pre><code class='html' lang='html'>&lt;script src=&quot;https://unpkg.com/@cityofzion/neon-js&quot;&gt;&lt;/script&gt;
</code></pre>
</figure>
<h3 id='b0ffa355'><span class='with-space bd-content-title'>Login<a class='anchorjs-link ' href='#b0ffa355' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>First of all, each user has to provide their private key in the hexstring format or WIF format to Login, to create account</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='let loginAccount = new Neon.wallet.Account(privateKey);'>Copy</button><pre><code class='js' lang='js'>let loginAccount = new Neon.wallet.Account(privateKey);
</code></pre>
</figure>
<p class='with-space'> <strong>important!</strong> This is only for demo usage and do not use it in the real product. It is not safe to use the privateKey in such way directly. The better way to use the privateKey to send the transaction and provide signature is to delegate such security problem to wallet applications, such as desktop wallet or browser extension.</p>
<h3 id='a1de3e7d'><span class='with-space bd-content-title'>Get balances<a class='anchorjs-link ' href='#a1de3e7d' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>There is 2 kinds of asset we used in this demo Dapp. First one is <code>NEO</code> token and the second one is called <code>Diamond</code> which is a NEP-5 Token.</p>
<p class='with-space'>To check the <code>NEO</code> balance, just need to query the <code>neo-scan</code> api which is embedded in the neon-js sdk. Just call the <code>getBalance</code> method and the result include the unspent NEO token of this specific address.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='var privateNetNeoscan = new Neon.api.neoscan.instance(&quot;PrivateNet&quot;);
privateNetNeoscan.getBalance(loginAccount.address).then(res =&gt; {
    console.log(res);
    updateGasDisplay(res);
});'>Copy</button><pre><code class='js' lang='js'>var privateNetNeoscan = new Neon.api.neoscan.instance(&quot;PrivateNet&quot;);
privateNetNeoscan.getBalance(loginAccount.address).then(res =&gt; {
    console.log(res);
    updateGasDisplay(res);
});
</code></pre>
</figure>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='function updateGasDisplay(balance) {
    if (balance.assets[&#39;NEO&#39;] === undefined) {
        globalNEODisplayEle.innerText = &#39;0&#39;;
        return ;
    }
    const unSpentUtxos = balance.assets[&#39;NEO&#39;].unspent;
    let NEOAmount = 0;
    unSpentUtxos.forEach(unspent =&gt; {
        NEOAmount += unspent.value.toNumber();
    });
    globalNEODisplayEle.innerText =  NEOAmount;
}'>Copy</button><pre><code class='js' lang='js'>function updateGasDisplay(balance) {
    if (balance.assets[&#39;NEO&#39;] === undefined) {
        globalNEODisplayEle.innerText = &#39;0&#39;;
        return ;
    }
    const unSpentUtxos = balance.assets[&#39;NEO&#39;].unspent;
    let NEOAmount = 0;
    unSpentUtxos.forEach(unspent =&gt; {
        NEOAmount += unspent.value.toNumber();
    });
    globalNEODisplayEle.innerText =  NEOAmount;
}
</code></pre>
</figure>
<p class='with-space'>To check the balance of the Diamond, we must call the <code>balanceOf</code> of the smart contract. To invoke the readonly method in the smart contract such as <code>balanceOf</code> or <code>name</code> , we just use the rpc query method to query the smart contract method. To call a readonly method in the smart contract, we have to provide two parameter, first is the contract address which is the scriptHash of the contract, the other one is the method name you want to call. Because function like <code>balanceOf</code> they need another parameter which is the address of the account you want to check. After fill these parameter, we can call the rpc query method and get the result immediately and re-render the front-end.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='function invokeScriptReadOnly(method, callback) {
    const methodParam = Neon.default.create.contractParam(&quot;String&quot;, method);
    const addressParam = Neon.sc.ContractParam.byteArray(
      loginAccount.address,
      &quot;address&quot;
    );
    Neon.rpc.Query.invoke(
        CONTRACT_SCRIPTHASH,
        methodParam,
        Neon.sc.ContractParam.array(addressParam)
    ).execute(&quot;http://seed6.ngd.network:20332&quot;).then(res =&gt; callback(res));
}'>Copy</button><pre><code class='js' lang='js'>function invokeScriptReadOnly(method, callback) {
    const methodParam = Neon.default.create.contractParam(&quot;String&quot;, method);
    const addressParam = Neon.sc.ContractParam.byteArray(
      loginAccount.address,
      &quot;address&quot;
    );
    Neon.rpc.Query.invoke(
        CONTRACT_SCRIPTHASH,
        methodParam,
        Neon.sc.ContractParam.array(addressParam)
    ).execute(&quot;http://seed6.ngd.network:20332&quot;).then(res =&gt; callback(res));
}
</code></pre>
</figure>
<h3 id='d31fd5a9'><span class='with-space bd-content-title'>Exchange Diamond (Mint Token)<a class='anchorjs-link ' href='#d31fd5a9' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>The initial balance of Diamond for a new user is 0. In order to get the diamond, the only way to do is to exchange it with NEO in your account. The method we have to call is the <code>exchange_token</code> function in the smart contract. The  method we use in the neon-js is <code>Neon.default.doInvoke</code> . Here we construct some elements this method will use. First one is intent, which is the transaction of UTXO asset (NEO token). It means we want to transfer some NEO to contract address (The address format of UTXO). Then here is the script part which needs to call the smart contract. It contains scripthash of smart contract, operation name and arguments of that method.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='  const intent = Neon.api.makeIntent({NEO:neoAmount}, CONTRACT_ADDRESS);
  const props = {
      scriptHash: CONTRACT_SCRIPTHASH,
      operation: &quot;exchange_token&quot;,
      args: []
  };
  const script = Neon.default.create.script(props);'>Copy</button><pre><code class='js' lang='js'>  const intent = Neon.api.makeIntent({NEO:neoAmount}, CONTRACT_ADDRESS);
  const props = {
      scriptHash: CONTRACT_SCRIPTHASH,
      operation: &quot;exchange_token&quot;,
      args: []
  };
  const script = Neon.default.create.script(props);
</code></pre>
</figure>
<p class='with-space'>Next we put all the things into an object which we call with the <code>Neon.default.doInvoke</code> function. Here I call the object <code>config</code> . It includes the api method, the account which you create in the beginning, the intent that includes the UTXO asset transfer and the script which call the function in the smart contract.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='  const config = {
      api: testNetNeoScan,
      account: loginAccount,
      intents: intent,
      script: script
  };'>Copy</button><pre><code class='js' lang='js'>  const config = {
      api: testNetNeoScan,
      account: loginAccount,
      intents: intent,
      script: script
  };
</code></pre>
</figure>
<p class='with-space'>Finally, we execute the <code>Neon.default.doInvoke(config)</code> and get the result back.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='Neon.default.doInvoke(config).then(res =&gt; {
      someCallback(res)
    }
}).catch(err =&gt; {
    console.log(err);
});'>Copy</button><pre><code class='js' lang='js'>Neon.default.doInvoke(config).then(res =&gt; {
      someCallback(res)
    }
}).catch(err =&gt; {
    console.log(err);
});
</code></pre>
</figure>
<h3 id='d30a3e53'><span class='with-space bd-content-title'>Get items and buy new item<a class='anchorjs-link ' href='#d30a3e53' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h3>
<p class='with-space'>To check the item from the smart contract, it is as easy as get the balance. The only function we have to call is invokeScriptReadOnly, which is similar to call the balanceOf function. The only difference is the function name changed to the <code>checkItem</code> .</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='invokeScriptReadOnly(&#39;checkItem&#39;, checkItemCallback);'>Copy</button><pre><code class='js' lang='js'>invokeScriptReadOnly(&#39;checkItem&#39;, checkItemCallback);
</code></pre>
</figure>
<p class='with-space'>To buy the new item, we have to use the doInvoke API of neon-js again.  It is similar to call the <code>exchange_token</code> function above. Here we use the nep-5 token only and do not need UTXO token. Therefore, we do not need the intent content and the only element we have to construct is the script and put it into a <code>config</code> object.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='const param_address = Neon.sc.ContractParam.byteArray(
      loginAccount.address,
      &quot;address&quot;
    );
const param_itemName = Neon.default.create.contractParam(&quot;String&quot;, ItemName);
const param_price = Neon.default.create.contractParam(&quot;Integer&quot;, price*1e8);

const props = {
    scriptHash: CONTRACT_SCRIPTHASH,
    operation: &quot;buyItem&quot;,
    args: [param_address, param_itemName, param_price]
};
const script = Neon.default.create.script(props);
const config = {
    api: testNetNeoScan,
    account: loginAccount,
    script: script
};'>Copy</button><pre><code class='js' lang='js'>const param_address = Neon.sc.ContractParam.byteArray(
      loginAccount.address,
      &quot;address&quot;
    );
const param_itemName = Neon.default.create.contractParam(&quot;String&quot;, ItemName);
const param_price = Neon.default.create.contractParam(&quot;Integer&quot;, price*1e8);

const props = {
    scriptHash: CONTRACT_SCRIPTHASH,
    operation: &quot;buyItem&quot;,
    args: [param_address, param_itemName, param_price]
};
const script = Neon.default.create.script(props);
const config = {
    api: testNetNeoScan,
    account: loginAccount,
    script: script
};
</code></pre>
</figure>
<p class='with-space'>Then, we execute the <code>Neon.default.doInvoke(config)</code> and get the result back.</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='Neon.default.doInvoke(config).then(res =&gt; {
      someCallback(res)
    }
}).catch(err =&gt; {
    console.log(err);
});'>Copy</button><pre><code class='js' lang='js'>Neon.default.doInvoke(config).then(res =&gt; {
      someCallback(res)
    }
}).catch(err =&gt; {
    console.log(err);
});
</code></pre>
</figure>
<h2 id='ba4e8332'><span class='with-space bd-content-title'>Deploy<a class='anchorjs-link ' href='#ba4e8332' aria-label='Anchor' data-anchorjs-icon='#'></a></span></h2>
<p class='with-space'>In order to run this Dapp, we use <a href='https://github.com/CityOfZion/neo-local' target='_blank'> neo-local</a> which enables user to fire up a personal NEO blockchain which you can use to run tests, execute commands, and inspect state while controlling how the chain operates. In neo-local, it fires up a private chain with four nodes and also run a neo-python for user. We can use neo-gui to deploy the contract or neo-python to deploy the contract, which leads to same outcome.</p>
<p class='with-space'>In neo-local, it will fire up a blockchain explorer <code>neo-scan</code> whose default url is <code>localhost:4000</code> . We can view all the blocks and transactions on it. In the javascript, we have to setup the neo-scan url:</p>
<figure class='highlight'>
<button type='button' class='btn-clipboard' data-original-title='Copy to clipboard' data-clipboard-action='copy' data-toggle='tooltip' data-placement='top' title='Copy to clipboard' data-clipboard-text='const NEO_SCAN_URL = &quot;https://localhost:4000/api/main_net&quot;;'>Copy</button><pre><code class='js' lang='js'>const NEO_SCAN_URL = &quot;https://localhost:4000/api/main_net&quot;;
</code></pre>
</figure>
<p class='with-space'>After deploy the smart contract on the neo-local, get the scripHash of your smart contract, and put it into corresponding place in the javascript file of your dapp. Then you just open the html file and get everything work!</p>
            </main>
            <div class="d-none d-lg-block side-nav py-2 py-md-5">
                <a href="https://github.com/neo-project/docs/blob/master/tutorial/en-us/dapp_demo\dapp.md" class="contribution-link d-block">Improve this Doc</a>
                <div class="side-nav-text">In this article</div>
                <div id="navbar-sidenav">
                    <nav class='nav nav-pills flex-column'>
<nav class='nav nav-pills flex-column'>
<a class='ml-0 my-1 nav-link' href='#fe5baa33'>Smart contract</a>
<nav class='nav nav-pills flex-column'>
<a class='ml-2 my-1 nav-link' href='#c6db5055'>Constant properties</a>
<a class='ml-2 my-1 nav-link' href='#b312cab3'>exchange_token(Mint Token)</a>
<a class='ml-2 my-1 nav-link' href='#c9d4a3e7'>Buy Items</a>
<a class='ml-2 my-1 nav-link' href='#b8a6cdcc'>Check Items</a>
</nav>
<a class='ml-0 my-1 nav-link' href='#bf4394e8'>Front end</a>
<nav class='nav nav-pills flex-column'>
<a class='ml-2 my-1 nav-link' href='#cb862f97'>Usage of neon-js</a>
<a class='ml-2 my-1 nav-link' href='#b0ffa355'>Login</a>
<a class='ml-2 my-1 nav-link' href='#a1de3e7d'>Get balances</a>
<a class='ml-2 my-1 nav-link' href='#d31fd5a9'>Exchange Diamond (Mint Token)</a>
<a class='ml-2 my-1 nav-link' href='#d30a3e53'>Get items and buy new item</a>
</nav>
<a class='ml-0 my-1 nav-link' href='#ba4e8332'>Deploy</a>
</nav>
</nav>
                </div>
            </div>
        </div>
    </div>
    <div class="lightbulb" title="Turn On/Off" onclick="turnOff()">
        <i class="far fa-lightbulb"></i>
    </div>
    <footer>
        <div class="d-flex justify-content-between py-1 px-3 px-sm-4 px-md-5">
            <ul class="d-none d-md-block">
                <li><a href="https://github.com/neo-project/docs" title="GitHub" target="_blank">GitHub</a></li>
                <li><a href="https://github.com/neo-project/docs/issues" title="Issue" target="_blank">Issue</a></li>
                <li><a href="https://discord.io/neo" title="Discord" target="_blank">Discord</a></li>
            </ul>
            <p>Build by <a href="https://github.com/chenzhitong/NeoDocsBuilder" title="NeoDocsBuilder" target="_blank">NeoDocsBuilder</a></p>
            <p>Licensed under <a href="https://github.com/neo-project/docs/blob/master/LICENSE" title="CC-BY-4.0" target="_blank">CC-BY-4.0</a> license. </p>
        </div>
    </footer>
    <script src="https://neo-cdn.azureedge.net/lib/jquery/jquery.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/lib/popper.js/popper.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/js/jquery.lazyload.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
    <script src="https://neo-cdn.azureedge.net/js/text-autospace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130525731-2"></script>
    <script src="/js/site.min.js"></script>
    <script>
        //适用于FAQ的根据标题展开收缩
        if (false) {
            $("h2").click(function (e) {
                $(".div-collapse").not($(e.target).parents("h2").next()).hide("fast");
                $(e.target).parents("h2").next().toggle("fast");
            });
        }
    </script>
</body>
</html>
